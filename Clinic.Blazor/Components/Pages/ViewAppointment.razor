@page "/view-appointment"
@using Clinic.Blazor.DTOs
@using Newtonsoft.Json
@inject ApiService apiService
@inject ISnackbar Snackbar
@rendermode InteractiveServer

<MudThemeProvider />
<MudPopoverProvider />
<MudDialogProvider />
<MudSnackbarProvider />
<h3>viewAppointment</h3>

<MudPaper Class="pa-4">
    @if (AppointmentList != null)
    {
        <p>Số lịch hẹn: @AppointmentList.Count</p>
    }

    @if (AppointmentList == null)
    {
        <MudProgressCircular Color="Color.Primary" Size="Size.Large" Indeterminate="true" />
        <p>Đang tải dữ liệu...</p>
    }
    else if (AppointmentList.Count == 0)
    {
        <MudAlert Severity="Severity.Info">Không có lịch hẹn nào trong hệ thống.</MudAlert>
    }
    else
    {
        <MudSimpleTable Style="overflow-x: auto;">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Ngày đặt hẹn</th>
                    <th>Giờ đặt hẹn</th>
                    <th>Trạng thái</th>
                    <th>ID Bác sĩ</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var row in AppointmentList)
                {
                    <tr>
                        <td>@row.Id</td>
                        <td>@row.Date</td>
                        <td>@row.Time</td>
                        <td>@row.Status</td>
                        <td>@row.DoctorId</td>
                    </tr>
                }
            </tbody>
        </MudSimpleTable>
    }
</MudPaper>

@code {
    private List<AppointmentPatientDto>? AppointmentList;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            var response = await apiService.GetAsync("/api/getappointment-patient/Get-Appointment-Patient");

            if (response.IsSuccessStatusCode)
            {
                var json = await response.Content.ReadAsStringAsync();
                AppointmentList = JsonConvert.DeserializeObject<List<AppointmentPatientDto>>(json);
            }
            else
            {
                AppointmentList = new List<AppointmentPatientDto>();
            }
        }
        catch (Exception)
        {
            AppointmentList = new List<AppointmentPatientDto>();
        }
    }
}
